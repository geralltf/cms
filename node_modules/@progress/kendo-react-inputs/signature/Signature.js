/**
 * @license
 *-------------------------------------------------------------------------------------------
 * Copyright Â© 2024 Progress Software Corporation. All rights reserved.
 * Licensed under commercial license. See LICENSE.md in the package root for more information
 *-------------------------------------------------------------------------------------------
 */
"use client";"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const Ce=require("@progress/kendo-inputs-common"),T=require("@progress/kendo-react-buttons"),s=require("@progress/kendo-react-common"),he=require("@progress/kendo-react-dialogs"),Se=require("@progress/kendo-react-intl"),a=require("prop-types"),ze=require("react"),m=require("../messages/index.js"),Oe=require("../package-metadata.js"),Ee=require("./utils/index.js"),B=require("@progress/kendo-svg-icons");function xe(l){const b=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(l){for(const p in l)if(p!=="default"){const e=Object.getOwnPropertyDescriptor(l,p);Object.defineProperty(b,p,e.get?e:{enumerable:!0,get:()=>l[p]})}}return b.default=l,Object.freeze(b)}const n=xe(ze),Me=250,Ie=84,te=3,ne=2,we="#000000",Pe="#ffffff",ee=l=>l!==void 0,oe=s.createPropsContext(),O=n.forwardRef((l,b)=>{s.validatePackage(Oe.packageMetadata);const p=s.usePropsContext(oe,l),e=n.useMemo(()=>({strokeWidth:i.strokeWidth,smooth:i.smooth,popupScale:i.popupScale,exportScale:i.exportScale,maximizable:i.maximizable,disabled:i.disabled,required:i.required,validityStyles:i.validityStyles,onChange:i.onChange,onFocus:i.onFocus,onBlur:i.onBlur,onOpen:i.onOpen,onClose:i.onClose,size:i.size,rounded:i.rounded,fillMode:i.fillMode,...p}),[p]),E=Se.useLocalization(),u=n.useRef(null),y=n.useRef(null),_=n.useRef(null),N=n.useRef(null),F=n.useRef(null),[r,ae]=n.useState(),[v,j]=n.useState(!1),[x,G]=n.useState(!1),[C,W]=n.useState(),[se,re]=n.useState(),A=ee(e.value)?e.value:C,[ie,le]=n.useState(!1),k=ee(e.open),g=k?e.open:ie,ce=e.maximized||x||!e.maximizable||e.disabled,ue=!(e.maximized&&!x),de=!(!(e.value||C)||x||e.readOnly||e.disabled),V=E.toLanguageString(m.signatureMaximize,m.messages[m.signatureMaximize]),U=E.toLanguageString(m.signatureMinimize,m.messages[m.signatureMinimize]),H=E.toLanguageString(m.signatureClear,m.messages[m.signatureClear]),M=e.popupScale||te,I=e.exportScale||ne,w=t=>{W(t),e.onChange&&e.onChange({value:t})},me=t=>{r==null||r.loadImage(t.value),w(t.value)};n.useEffect(()=>{e.value!==C&&(W(e.value),r==null||r.loadImage(e.value))},[e.value]);const pe=()=>{r==null||r.clear(),w()},h=n.useCallback(t=>{k||le(t)},[k]),fe=t=>{var o,c;Q(t),(c=((o=F.current)==null?void 0:o.element)||y.current)==null||c.focus()},P=n.useCallback(()=>{let t=we;return!e.color&&typeof document!="undefined"&&u.current&&(t=getComputedStyle(u.current).color),e.color||t},[e.color]),L=n.useCallback(()=>{let t=Pe;return!e.backgroundColor&&typeof document!="undefined"&&u.current&&(t=getComputedStyle(u.current).backgroundColor),e.backgroundColor||t},[e.backgroundColor]),$=()=>({scale:e.maximized?e.popupScale:1,color:P(),backgroundColor:L(),strokeWidth:e.strokeWidth,smooth:e.smooth,readonly:e.readOnly}),K=async t=>{const{width:o,height:c}=t;return await(r==null?void 0:r.exportImage({width:o*I,height:c*I}))};n.useEffect(()=>{const t=y.current,o=new Ce.SignaturePad(t,$());return A&&o.loadImage(A),ae(o),()=>o.destroy()},[]),n.useEffect(()=>{r==null||r.setOptions({onChange:async()=>w(await K(Y())),onDraw:()=>G(!0),onDrawEnd:()=>G(!1)})},[r]),s.useIsomorphicLayoutEffect(()=>r==null?void 0:r.setOptions($()),[e.readOnly,e.color,e.backgroundColor,e.strokeWidth,e.smooth]),n.useEffect(()=>{var c,f;const t=(f=(c=_.current)==null?void 0:c.element)==null?void 0:f.querySelector(".k-overlay");if(!t)return;const o=()=>h(!1);return t.addEventListener("click",o),()=>t.removeEventListener("click",o)},[g]),n.useEffect(()=>{if(!g||typeof document=="undefined")return;const t=o=>{o.keyCode===s.Keys.esc&&h(!1)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[g]),n.useEffect(()=>{var t,o;e.maximized&&((o=(t=N.current)==null?void 0:t.element)==null||o.focus())},[]);const q=n.useCallback(()=>{var t;return(t=y.current)==null?void 0:t.focus()},[]),S=n.useCallback(()=>e.value,[e.value]),X=n.useCallback(()=>e.name,[e.name]),z=n.useCallback(()=>e.required,[e.required]),D=n.useCallback(()=>{const t=e.validationMessage!==void 0,c=!S(),f=e.valid!==void 0?e.valid:!z()||!c;return{customError:t,valid:f,valueMissing:c}},[e.validationMessage,e.valid,S,z]),R=n.useCallback(()=>e.validityStyles,[e.validityStyles]),J=n.useCallback(()=>e,[e]),d=n.useCallback(()=>{const t={element:u.current,focus:q};return Object.defineProperty(t,"name",{get:X}),Object.defineProperty(t,"value",{get:S}),Object.defineProperty(t,"validity",{get:D}),Object.defineProperty(t,"validityStyles",{get:R}),Object.defineProperty(t,"required",{get:z}),Object.defineProperty(t,"props",{get:J}),Object.defineProperty(t,"color",{get:P}),Object.defineProperty(t,"backgroundColor",{get:L}),t},[X,S,D,R,z,q,J,P,L]);n.useImperativeHandle(b,d);const ge=n.useCallback(t=>{v||e.maximized||(j(!0),s.dispatchEvent(e.onFocus,t,d(),{}))},[v,e.onFocus,d]),be=n.useCallback(t=>{Ee.hasParent(t.relatedTarget,u.current)||(j(!1),s.dispatchEvent(e.onBlur,t,d(),{}))},[v,e.onBlur,d]),ke=n.useCallback(async t=>{re(await K(Z())),h(!0),s.dispatchEvent(e.onOpen,t,d(),{})},[g,k,e.onOpen,e.value,C,d]),Q=n.useCallback(t=>{h(!1),s.dispatchEvent(e.onClose,t,d(),{})},[g,k,e.onClose,d]),ye=()=>{pe(),q()},Y=()=>{var c,f;const t=e.width||((c=u.current)==null?void 0:c.offsetWidth)||Me,o=e.height||((f=u.current)==null?void 0:f.offsetHeight)||Ie;return{width:t,height:o}},Z=()=>{const{width:t,height:o}=Y();return{width:t*M,height:o*M}},ve=!R()||D().valid;return n.createElement("div",{ref:u,dir:e.dir,style:{width:e.width,height:e.height,...e.style},className:s.classNames("k-input","k-signature",{"k-signature-maximized":e.maximized,[`k-signature-${s.kendoThemeMaps.sizeMap[e.size]||e.size}`]:e.size,[`k-signature-${e.fillMode}`]:e.fillMode,[`k-input-${e.fillMode}`]:e.fillMode,[`k-rounded-${s.kendoThemeMaps.roundedMap[e.rounded]||e.rounded}`]:e.rounded,"k-invalid":!ve,"k-required":e.required,"k-disabled":e.disabled,"k-focus":v},e.className),onFocus:ge,onBlur:be},n.createElement("div",{className:"k-signature-canvas",ref:y,tabIndex:s.getTabIndex(e.tabIndex,e.disabled),role:"img",id:e.id,"aria-label":e.ariaLabel,"aria-labelledby":e.ariaLabelledBy,"aria-describedby":e.ariaDescribedBy,"aria-disabled":e.disabled?"true":void 0}),n.createElement("div",{className:"k-signature-actions k-signature-actions-top"},n.createElement(T.Button,{type:"button",className:s.classNames("k-signature-action","k-signature-maximize",{"k-hidden":e.disabled||ce}),ref:F,icon:"hyperlink-open",svgIcon:B.hyperlinkOpenIcon,fillMode:"flat",size:e.size,onClick:ke,"aria-label":V,title:V}),n.createElement(T.Button,{type:"button",className:s.classNames("k-signature-action","k-signature-minimize","k-rotate-180",{"k-hidden":e.disabled||ue}),ref:N,icon:"hyperlink-open",svgIcon:B.hyperlinkOpenIcon,fillMode:"flat",size:e.size,onClick:Q,"aria-label":U,title:U})),!e.hideLine&&n.createElement("div",{className:"k-signature-line",style:{zIndex:2,pointerEvents:"none"}}),n.createElement("div",{className:"k-signature-actions k-signature-actions-bottom"},de&&n.createElement(T.Button,{type:"button",className:"k-signature-action k-signature-clear",icon:"x",svgIcon:B.xIcon,fillMode:"flat",size:e.size,onClick:ye,"aria-label":H,title:H})),g&&n.createElement(he.Dialog,{ref:_},n.createElement(O,{...e,...Z(),value:se,maximized:!0,exportScale:1/M*I,open:!1,onChange:me,onClose:fe})))});O.propTypes={value:a.string,width:a.number,height:a.number,tabIndex:a.number,dir:a.string,ariaDescribedBy:a.string,ariaLabelledBy:a.string,ariaLabel:a.string,readOnly:a.bool,disabled:a.bool,validationMessage:a.string,required:a.bool,onChange:a.func,onFocus:a.func,onBlur:a.func,onOpen:a.func,onClose:a.func,size:a.oneOf([null,"small","medium","large"]),rounded:a.oneOf([null,"small","medium","large"]),fillMode:a.oneOf([null,"solid","flat","outline"])};const i={strokeWidth:1,smooth:!1,popupScale:te,exportScale:ne,maximizable:!0,disabled:!1,required:!1,validityStyles:!0,onChange:l=>s.noop,onFocus:l=>s.noop,onBlur:l=>s.noop,onOpen:l=>s.noop,onClose:l=>s.noop,size:"medium",rounded:"medium",fillMode:"solid"};O.displayName="KendoSignature";exports.Signature=O;exports.SignaturePropsContext=oe;
